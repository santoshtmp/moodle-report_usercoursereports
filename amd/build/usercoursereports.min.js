/**
 * AMD module for User Course Reports filter
 *
 * @copyright  2025 https://santoshmagar.com.np/
 * @author     santoshtmp7
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_usercoursereports/usercoursereports",["jquery","core/ajax","core/str"],(function($,Ajax,str){const filterFormId="usercoursereports-filter",filterAreaId="report-usercoursereports-filter-area";function getFilterReportTable(formquerystring){$("#"+filterAreaId).attr("aria-busy","true"),$("#applyfilter").prop("disabled",!0),$("#filter-loading-wrapper").show();const request={methodname:"report_usercoursereports_get_report_table",args:{querystring:formquerystring}},ajaxrequest=Ajax.call([request])[0];ajaxrequest.done((function(response){if(response.status&&response.reporttable&&(window.history.replaceState("","url",response.pageurl),$("#"+filterAreaId).replaceWith(response.reporttable)),$("#"+filterFormId+" [id^=id_error_]").html("").hide(),!response.is_validated){(response.validation_errors||[]).forEach((element=>{let errorContainer=$("#id_error_"+element.field);errorContainer.length&&errorContainer.html(element.error).show()}))}$("#error-response-message").remove(),!response.status&&response.message&&$("#"+filterAreaId).prepend('<p id="error-response-message" class="invalid-feedback" style="display:block;">'+response.message+"</p>")})),ajaxrequest.fail((function(response){window.console.log(response),$("#error-response-message").remove(),$("#"+filterAreaId).prepend('<p id="error-response-message" class="invalid-feedback" style="display:block;">'+response.message+"</p>")})),ajaxrequest.always((function(){$("#"+filterAreaId).removeAttr("aria-busy"),$("#applyfilter").prop("disabled",!1),$("#filter-loading-wrapper").hide()}))}function formReset(filterFormId){const form=$("#"+filterFormId);return!!form.length&&(form[0].reset(),form.find(".form-autocomplete-selection").html(""),form.find(".usercoursereports-filter-field").each((function(){var $wrapper=$(this);$wrapper.find("input, select, textarea").each((function(){var $el=$(this),type=$el.attr("type");$el.is("select")?$el.find('option[value="0"]').length?$el.val("0"):$el.find('option[value="all"]').length&&$el.val("all"):"checkbox"===type||"radio"===type?$el.prop("checked",!1):"number"===type?$el.val($el.attr("default-value")||50):$el.val("")})),$wrapper.find("input, select, textarea").trigger("change")})),!0)}return{init:function(pagedata){if($(".usercoursereports-filter-field div.col-md-3, .usercoursereports-filter-field div.col-md-9").each((function(){$(this).removeClass("col-md-3 col-md-9")})),document.getElementById("id_perpage")&&document.getElementById("id_perpage").setAttribute("type","number"),function(){if($(document).on("click",'.usercoursereports [aria-controls="reportgeneraldetailcontent"]',(function(){const $icon=$(this).find(".fa");"true"===$(this).attr("aria-expanded")?($icon.removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).attr("aria-expanded",!1)):($icon.removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).attr("aria-expanded",!0)),$("#reportgeneraldetailcontent").toggle("show")})),document.querySelector(".usercoursereports .readmore-btn")){const readmorePromise=str.get_string("readmore","report_usercoursereports"),showlessPromise=str.get_string("showless","report_usercoursereports");Promise.all([readmorePromise,showlessPromise]).then((_ref=>{let[readmoreText,showlessText]=_ref;return document.querySelectorAll(".usercoursereports").forEach((card=>{const summary=card.querySelector(".course-summary"),btn=card.querySelector(".readmore-btn");return!(!summary||!btn||(summary.scrollHeight>summary.clientHeight&&btn.classList.remove("d-none"),btn.addEventListener("click",(()=>{summary.classList.toggle("collapsed-summary"),btn.textContent=summary.classList.contains("collapsed-summary")?readmoreText:showlessText})),0))})),!0})).catch((err=>(window.console.error(err),!1)))}}(),$('input[value="_qf__force_multiselect_submission"]').each((function(){$(this).val(""),$(this).attr("name","")})),$("#"+filterFormId).on("submit",(function(e){if("cancel"!==$(this).find("input[type=submit]:focus").attr("name")){e.preventDefault();getFilterReportTable($(this).serialize())}})),$(document).on("click","#"+filterAreaId+" nav.pagination a.page-link",(function(e){e.preventDefault();const formquerystring=$(this).attr("href").split("?")[1];formquerystring&&getFilterReportTable(formquerystring)})),$(document).on("click","#"+filterAreaId+' thead th.header a[data-sortable="1"]',(function(e){e.preventDefault();const formquerystring=$(this).attr("href").split("?")[1];formquerystring&&getFilterReportTable(formquerystring)})),$(document).on("click","#"+filterAreaId+" .resettable a",(function(e){e.preventDefault();const formquerystring=$(this).attr("href").split("?")[1];return!!formquerystring&&(getFilterReportTable(formquerystring),formReset(filterFormId))})),$(document).on("click","#"+filterFormId+" #clearfilter",(function(e){let formquerystring="";if(pagedata.pagereseturl){formquerystring=new URL(pagedata.pagereseturl,window.location.origin).searchParams.toString()}return!formquerystring||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),getFilterReportTable(formquerystring),formReset(filterFormId))})),$("#usercoursereports-single-search select#id_id").on("change",(function(){if($(this).val()){var form=$(this).closest("form");form.attr("data-form-dirty",!1),form.submit()}return!0})),$(".singleuserdetail.my-enrolled-courses #report-usercoursereports-filter-area").length||$(".singlecoursedetails.courseparticipation #report-usercoursereports-filter-area").length){let formquerystring="";if(pagedata.pagereseturl){formquerystring=new URL(pagedata.pagereseturl,window.location.origin).searchParams.toString()}formquerystring&&getFilterReportTable(formquerystring)}}}}));

//# sourceMappingURL=usercoursereports.min.js.map