{"version":3,"file":"usercoursereports.min.js","sources":["../src/usercoursereports.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for User Course Reports filter + AJAX call\n *\n * @copyright  2025 https://santoshmagar.com.np/\n * @author     santoshtmp7\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax'], function ($, Ajax) {\n\n    var filter_area_id = 'report-usercoursereports-filter-area';\n    var applyfilterbtn_id = 'applyfilter';\n\n    /**\n     *\n     * @param {*} formquerystring\n     */\n    function get_filter_report_table(formquerystring) {\n        $('#' + filter_area_id).attr('aria-busy', 'true');\n        $('#' + applyfilterbtn_id).prop('disabled', true);\n        $('#filter-loading-wrapper').show();\n        // make ajax call\n        const request = {\n            methodname: 'report_usercoursereports_get_report_table',\n            args: {\n                querystring: formquerystring,\n            }\n        };\n        const ajaxrequest = Ajax.call([request])[0];\n        ajaxrequest.done(function (response) {\n            // update report filter table content\n            if (response.status && response.reporttable) {\n                window.history.replaceState('', 'url', response.pageurl);\n                $('#' + filter_area_id).replaceWith(response.reporttable);\n            }\n            // field validation and error\n            $('#usercoursereports-filter [id^=id_error_]').html('').hide();\n            if (!response.is_validated) {\n                let validation_errors = response.validation_errors || [];\n                validation_errors.forEach(element => {\n                    let $errorContainer = $('#id_error_' + element.field);\n                    if ($errorContainer.length) {\n                        $errorContainer.html(element.error).show();\n                    }\n                });\n            }\n            // error message priint when status is false.\n            if (!response.status && response.message) {\n                $('#error-response-message').remove();\n                $('#' + filter_area_id).prepend(\n                    '<p id=\"error-response-message\" class=\"invalid-feedback\" style=\"display:block;\">' + response.message + '</p>'\n                );\n            }\n        });\n        ajaxrequest.fail(function (response) {\n            window.console.log(response);\n        });\n        ajaxrequest.always(function () {\n            $('#' + filter_area_id).removeAttr('aria-busy');\n            $('#' + applyfilterbtn_id).prop('disabled', false);\n            $('#filter-loading-wrapper').hide();\n        });\n    }\n\n    return {\n        init: function () {\n\n            // Remove .col-md-3 and .col-md-9 from divs inside .usercoursereports-filter-field\n            $('.usercoursereports-filter-field div.col-md-3, .usercoursereports-filter-field div.col-md-9').each(function () {\n                $(this).removeClass('col-md-3 col-md-9');\n            });\n\n            // Change per page field type from text to number\n            if (document.getElementById('id_perpage')) {\n                document.getElementById('id_perpage').setAttribute('type', 'number');\n            }\n\n            // On form submit\n            $('#usercoursereports-filter').on('submit', function (e) {\n                let clickedButton = $(this).find('input[type=submit]:focus').attr('name');\n                if (clickedButton != 'cancel') {\n                    e.preventDefault();\n                    const formquerystring = $(this).serialize();\n                    get_filter_report_table(formquerystring);\n                }\n            });\n\n            // Pagination.\n            $(document).on('click', '#' + filter_area_id + ' nav.pagination a.page-link', function (e) {\n                e.preventDefault();\n                const formquerystring = $(this).attr('href').split('?')[1];\n                if (formquerystring) {\n                    get_filter_report_table(formquerystring);\n                }\n            });\n\n        }\n    };\n});\n"],"names":["define","$","Ajax","filter_area_id","get_filter_report_table","formquerystring","attr","prop","show","request","methodname","args","querystring","ajaxrequest","call","done","response","status","reporttable","window","history","replaceState","pageurl","replaceWith","html","hide","is_validated","validation_errors","forEach","element","$errorContainer","field","length","error","message","remove","prepend","fail","console","log","always","removeAttr","init","each","this","removeClass","document","getElementById","setAttribute","on","e","find","preventDefault","serialize","split"],"mappings":";;;;;;;AAuBAA,oDAAO,CAAC,SAAU,cAAc,SAAUC,EAAGC,UAErCC,eAAiB,gDAOZC,wBAAwBC,iBAC7BJ,EAAE,IAAME,gBAAgBG,KAAK,YAAa,QAC1CL,EAAE,gBAAyBM,KAAK,YAAY,GAC5CN,EAAE,2BAA2BO,aAEvBC,QAAU,CACZC,WAAY,4CACZC,KAAM,CACFC,YAAaP,kBAGfQ,YAAcX,KAAKY,KAAK,CAACL,UAAU,GACzCI,YAAYE,MAAK,SAAUC,aAEnBA,SAASC,QAAUD,SAASE,cAC5BC,OAAOC,QAAQC,aAAa,GAAI,MAAOL,SAASM,SAChDrB,EAAE,IAAME,gBAAgBoB,YAAYP,SAASE,cAGjDjB,EAAE,6CAA6CuB,KAAK,IAAIC,QACnDT,SAASU,aAAc,EACAV,SAASW,mBAAqB,IACpCC,SAAQC,cAClBC,gBAAkB7B,EAAE,aAAe4B,QAAQE,OAC3CD,gBAAgBE,QAChBF,gBAAgBN,KAAKK,QAAQI,OAAOzB,WAK3CQ,SAASC,QAAUD,SAASkB,UAC7BjC,EAAE,2BAA2BkC,SAC7BlC,EAAE,IAAME,gBAAgBiC,QACpB,kFAAoFpB,SAASkB,QAAU,YAInHrB,YAAYwB,MAAK,SAAUrB,UACvBG,OAAOmB,QAAQC,IAAIvB,aAEvBH,YAAY2B,QAAO,WACfvC,EAAE,IAAME,gBAAgBsC,WAAW,aACnCxC,EAAE,gBAAyBM,KAAK,YAAY,GAC5CN,EAAE,2BAA2BwB,gBAI9B,CACHiB,KAAM,WAGFzC,EAAE,8FAA8F0C,MAAK,WACjG1C,EAAE2C,MAAMC,YAAY,wBAIpBC,SAASC,eAAe,eACxBD,SAASC,eAAe,cAAcC,aAAa,OAAQ,UAI/D/C,EAAE,6BAA6BgD,GAAG,UAAU,SAAUC,MAE7B,UADDjD,EAAE2C,MAAMO,KAAK,4BAA4B7C,KAAK,QACnC,CAC3B4C,EAAEE,iBAEFhD,wBADwBH,EAAE2C,MAAMS,iBAMxCpD,EAAE6C,UAAUG,GAAG,QAAS,IAAM9C,eAAiB,+BAA+B,SAAU+C,GACpFA,EAAEE,uBACI/C,gBAAkBJ,EAAE2C,MAAMtC,KAAK,QAAQgD,MAAM,KAAK,GACpDjD,iBACAD,wBAAwBC"}